(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[812],{4435:function(e,t,a){Promise.resolve().then(a.bind(a,7747))},7747:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var i=a(7437),r=a(2265),l=a(9376),s=a(6861),n=a(154),o=a(4881),d=a(8752),u=a(1945),c=a(8246);function m(e){let{message:t="Loading...",size:a="medium"}=e;return(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center p-8",children:[(0,i.jsx)("div",{className:"".concat({small:"w-4 h-4",medium:"w-8 h-8",large:"w-12 h-12"}[a]," border-2 border-t-primary border-r-transparent border-b-primary border-l-transparent rounded-full animate-spin mb-4")}),(0,i.jsx)("p",{className:"".concat({small:"text-sm",medium:"text-base",large:"text-lg"}[a]," text-muted-foreground"),children:t})]})}function p(e){let{params:t}=e,[a,p]=(0,r.useState)(null),[f,h]=(0,r.useState)([]),[g,v]=(0,r.useState)(!0),[x,y]=(0,r.useState)(!1),[b,j]=(0,r.useState)(null),w=(0,l.useRouter)(),E=(0,o.a)(),N=null==E?void 0:E.user;(0,r.useEffect)(()=>{let e=async()=>{try{v(!0);let e=await s.t.getById(t.id);p(e),j(e.version);let a=await n.wE.getAllTopics();h(a)}catch(e){console.error("Error fetching data:",e),(0,d.Am)({title:"Error",description:"Failed to load template data. Please try again.",variant:"destructive"})}finally{v(!1)}};N?e():w.push("/auth/login")},[t.id,N,w]);let A=async e=>{if(!b){(0,d.Am)({title:"Error",description:"Could not determine template version. Please reload the page.",variant:"destructive"});return}try{y(!0);let a={...e,version:b};await s.t.updateTemplate(t.id,a,b),(0,d.Am)({title:"Success",description:"Template updated successfully."}),w.push("/templates/".concat(t.id))}catch(e){var a;if(console.error("Error updating template:",e),null==e?void 0:null===(a=e.message)||void 0===a?void 0:a.includes("Version conflict")){(0,d.Am)({title:"Update conflict",description:"This template was modified by someone else. Please refresh and try again.",variant:"destructive"});return}(0,d.Am)({title:"Error",description:"Failed to update template. Please try again.",variant:"destructive"})}finally{y(!1)}};return N?(0,i.jsxs)(u.c,{user:{name:N.name||"",email:N.email||"",isAdmin:N.isAdmin||!1},onLogout:()=>{(null==E?void 0:E.logout)&&(E.logout(),w.push("/auth/login"))},children:[(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold",children:"Edit Template"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:"Update your form template"})]}),g?(0,i.jsx)(m,{message:"Loading template data..."}):(0,i.jsx)(c.O,{topics:f,initialData:a,handleSave:A,handleCancel:()=>{w.push("/templates/".concat(t.id))},isSubmitting:x})]}):(0,i.jsx)(m,{message:"Please wait..."})}}},function(e){e.O(0,[834,360,541,64,221,439,936,32,961,275,971,117,744],function(){return e(e.s=4435)}),_N_E=e.O()}]);