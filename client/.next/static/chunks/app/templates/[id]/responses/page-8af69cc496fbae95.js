(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72],{576:function(e,t,s){Promise.resolve().then(s.bind(s,3054))},2451:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},2735:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},5805:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},3054:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var a=s(7437),r=s(2265),n=s(1945),l=s(9820),o=s(2381),i=s(6861),c=s(5493);let d={async submitResponse(e){try{return(await c.Z.post("/responses",e)).data}catch(e){throw console.error("Failed to submit form response:",e),e}},async getResponsesByTemplate(e){try{return(await c.Z.get("/responses/template/".concat(e))).data}catch(t){throw console.error("Failed to fetch responses for template ".concat(e,":"),t),t}},async getResponseById(e){try{return(await c.Z.get("/responses/".concat(e))).data}catch(t){throw console.error("Failed to fetch response ".concat(e,":"),t),t}},async getUserResponses(){try{return(await c.Z.get("/responses/user")).data}catch(e){throw console.error("Failed to fetch user responses:",e),e}},async getAggregateData(e){try{return(await c.Z.get("/responses/aggregate/".concat(e))).data}catch(t){throw console.error("Failed to fetch aggregate data for template ".concat(e,":"),t),t}}};var m=s(9140),u=s(2451);let h=(0,s(9763).Z)("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);var p=s(2735),x=s(5805),f=s(9376),g=s(4881),y=s(8752),j=s(3804),v=s(7648);function N(e){let{params:t}=e,[s,c]=(0,r.useState)(!0),[N,w]=(0,r.useState)(null),[b,A]=(0,r.useState)([]),[R,k]=(0,r.useState)(null),Z=(0,f.useRouter)(),S=(0,g.a)(),T=null==S?void 0:S.user,C=t.id;function F(e){return e?new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}return((0,r.useEffect)(()=>{let e=async()=>{try{c(!0);let e=await i.t.getTemplateById(C);if(w(e),e.userId!==(null==T?void 0:T.id)&&!(null==T?void 0:T.isAdmin)){(0,y.Am)({title:"Access denied",description:"You don't have permission to view responses for this template.",variant:"destructive"}),Z.push("/templates/".concat(C));return}let t=await d.getResponsesByTemplate(C);A(t);let s=await d.getResponseAggregates(C);k(s)}catch(e){console.error("Error fetching data:",e),(0,y.Am)({title:"Error",description:"Failed to load responses. Please try again.",variant:"destructive"})}finally{c(!1)}};T?e():Z.push("/auth/login")},[C,T,Z]),T)?(0,a.jsxs)(n.c,{user:{name:T.name,email:T.email,isAdmin:T.isAdmin},onLogout:()=>{null==S||S.logout(),Z.push("/auth/login")},children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)(o.z,{variant:"ghost",size:"sm",onClick:()=>Z.push("/templates/".concat(C)),children:[(0,a.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Back to Template"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>Z.push("/templates/".concat(C,"/statistics")),children:[(0,a.jsx)(h,{className:"mr-2 h-4 w-4"}),"Statistics"]}),(0,a.jsxs)(o.z,{variant:"outline",size:"sm",onClick:function(){if(!b.length)return;let e=new Set;b.forEach(t=>{Object.keys(t).forEach(t=>{["id","templateId","userId","createdAt","updatedAt","template","user"].includes(t)||e.add(t)})});let t=["ID","Submitted By","Submission Date",...Array.from(e)],s=b.map(t=>{var s;let a=[t.id,(null===(s=t.user)||void 0===s?void 0:s.name)||"Anonymous",F(t.createdAt)];return Array.from(e).forEach(e=>{let s=t[e];a.push(void 0!==s?s:"")}),a}),a=new Blob([[t.join(","),...s.map(e=>e.map(e=>'"'.concat(e,'"')).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(a),n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download","".concat((null==N?void 0:N.title)||"template","-responses.csv")),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)},disabled:!b.length,children:[(0,a.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"Export CSV"]})]})]}),s?(0,a.jsx)(m.O,{className:"h-8 w-2/3"}):(0,a.jsxs)("h1",{className:"text-2xl font-bold",children:["Responses: ",null==N?void 0:N.title]})]}),(0,a.jsxs)(l.Zb,{className:"mb-6",children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)(l.ll,{className:"text-xl",children:"Response Summary"})})}),(0,a.jsx)(l.aY,{children:s?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[void 0,void 0,void 0].map((e,t)=>(0,a.jsx)(m.O,{className:"h-24 w-full"},t))}):(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-muted/50 p-4 rounded-md",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Responses"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:b.length})]}),(null==N?void 0:N.isQuiz)&&(0,a.jsxs)("div",{className:"bg-muted/50 p-4 rounded-md",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Average Score"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:(null==R?void 0:R.avg_score)?"".concat(Math.round(10*R.avg_score)/10,"/").concat(Math.round(R.avg_total_points)):"N/A"})]}),(0,a.jsxs)("div",{className:"bg-muted/50 p-4 rounded-md",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Latest Response"}),(0,a.jsx)("div",{className:"text-lg font-medium",children:b.length>0?F(b[0].createdAt):"No responses yet"})]})]})})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"flex items-center",children:[(0,a.jsx)(x.Z,{className:"h-5 w-5 mr-2"}),"All Responses"]})}),(0,a.jsx)(l.aY,{children:s?(0,a.jsx)("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsx)(m.O,{className:"h-12 w-full"},t))}):b.length>0?(0,a.jsxs)(j.iA,{children:[(0,a.jsx)(j.Rn,{children:"A list of all responses for this template."}),(0,a.jsx)(j.xD,{children:(0,a.jsxs)(j.SC,{children:[(0,a.jsx)(j.ss,{children:"Respondent"}),(0,a.jsx)(j.ss,{children:"Date Submitted"}),(null==N?void 0:N.isQuiz)&&(0,a.jsx)(j.ss,{children:"Score"}),(0,a.jsx)(j.ss,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(j.RM,{children:b.map(e=>{var t;return(0,a.jsxs)(j.SC,{children:[(0,a.jsx)(j.pj,{className:"font-medium",children:(null===(t=e.user)||void 0===t?void 0:t.name)||"Anonymous"}),(0,a.jsx)(j.pj,{children:F(e.createdAt)}),(null==N?void 0:N.isQuiz)&&(0,a.jsx)(j.pj,{children:void 0!==e.score&&void 0!==e.totalPossiblePoints?(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium",children:[e.score,"/",e.totalPossiblePoints]}),(0,a.jsxs)("span",{className:"ml-2 text-sm text-muted-foreground",children:["(",Math.round(e.score/e.totalPossiblePoints*100),"%)"]})]}):"N/A"}),(0,a.jsx)(j.pj,{className:"text-right",children:(0,a.jsx)(o.z,{asChild:!0,variant:"outline",size:"sm",children:(0,a.jsx)(v.default,{href:"/templates/".concat(C,"/responses/").concat(e.id),children:"View Details"})})})]},e.id)})})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,a.jsx)(x.Z,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium",children:"No responses yet"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"There are no responses to this template yet."})]})})]})]}):(0,a.jsx)("div",{children:"Loading..."})}},9140:function(e,t,s){"use strict";s.d(t,{O:function(){return n}});var a=s(7437),r=s(3448);function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,r.cn)("animate-pulse rounded-md bg-muted",t),...s})}},3804:function(e,t,s){"use strict";s.d(t,{RM:function(){return i},Rn:function(){return u},SC:function(){return c},iA:function(){return l},pj:function(){return m},ss:function(){return d},xD:function(){return o}});var a=s(7437),r=s(2265),n=s(3448);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{className:"w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,n.cn)("w-full caption-bottom text-sm",s),...r})})});l.displayName="Table";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("thead",{ref:t,className:(0,n.cn)("[&_tr]:border-b",s),...r})});o.displayName="TableHeader";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,n.cn)("[&_tr:last-child]:border-0",s),...r})});i.displayName="TableBody",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,n.cn)("bg-primary font-medium text-primary-foreground",s),...r})}).displayName="TableFooter";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tr",{ref:t,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r})});c.displayName="TableRow";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("th",{ref:t,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...r})});d.displayName="TableHead";let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("td",{ref:t,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});m.displayName="TableCell";let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("caption",{ref:t,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",s),...r})});u.displayName="TableCaption"},6861:function(e,t,s){"use strict";s.d(t,{t:function(){return r}});var a=s(5493);let r={async getAllTemplates(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{return(await a.Z.get("/templates?page=".concat(e,"&limit=").concat(t))).data}catch(e){throw console.error("Failed to fetch templates:",e),e}},async getTemplateById(e){try{return(await a.Z.get("/templates/".concat(e))).data}catch(t){throw console.error("Failed to fetch template ".concat(e,":"),t),t}},async createTemplate(e){try{return(await a.Z.post("/templates",e)).data}catch(e){throw console.error("Failed to create template:",e),e}},async updateTemplate(e,t){try{return(await a.Z.put("/templates/".concat(e),t)).data.template}catch(t){throw console.error("Failed to update template ".concat(e,":"),t),t}},async deleteTemplate(e,t){try{await a.Z.delete("/templates/".concat(e),{data:{version:t}})}catch(t){throw console.error("Failed to delete template ".concat(e,":"),t),t}},async searchTemplates(e){try{let t=new URLSearchParams;return e.query&&t.append("query",e.query),e.tag&&t.append("tag",e.tag),e.topicId&&t.append("topicId",e.topicId),e.limit&&t.append("limit",e.limit.toString()),e.page&&t.append("page",e.page.toString()),e.sort&&t.append("sort",e.sort),(await a.Z.get("/templates/search?".concat(t.toString()))).data}catch(e){throw console.error("Failed to search templates:",e),e}}}}},function(e){e.O(0,[284,464,972,52,534,128,713,439,32,961,971,117,744],function(){return e(e.s=576)}),_N_E=e.O()}]);