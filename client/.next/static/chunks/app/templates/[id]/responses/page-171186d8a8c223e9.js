(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72],{576:function(e,t,s){Promise.resolve().then(s.bind(s,3054))},2451:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},2735:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},5805:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},3054:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var a=s(7437),r=s(2265),n=s(1945),l=s(9820),i=s(2381),o=s(6861),d=s(5493);let c={async submitResponse(e){try{return(await d.Z.post("/form-responses",e)).data}catch(e){var t,s,a;if(console.error("Error submitting form response:",e),null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.requiresAuth)throw{...e.response.data,requiresAuth:!0};throw(null===(a=e.response)||void 0===a?void 0:a.data)||{message:"Failed to submit form response"}}},async getUserResponses(){try{return(await d.Z.get("/form-responses/user")).data}catch(t){var e;throw console.error("Error fetching user responses:",t),(null===(e=t.response)||void 0===e?void 0:e.data)||{message:"Failed to fetch responses"}}},async getResponseById(e){try{return(await d.Z.get("/form-responses/".concat(e))).data}catch(e){var t;throw console.error("Error fetching response:",e),(null===(t=e.response)||void 0===t?void 0:t.data)||{message:"Failed to fetch response"}}},async getResponsesByTemplate(e){try{return(await d.Z.get("/form-responses/template/".concat(e))).data}catch(e){var t;throw console.error("Error fetching template responses:",e),(null===(t=e.response)||void 0===t?void 0:t.data)||{message:"Failed to fetch template responses"}}},async getResponseAggregates(e){try{return(await d.Z.get("/form-responses/aggregate/".concat(e))).data}catch(e){var t;throw console.error("Error fetching response aggregates:",e),(null===(t=e.response)||void 0===t?void 0:t.data)||{message:"Failed to fetch response statistics"}}}};var u=s(9140),m=s(2451);let p=(0,s(9763).Z)("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);var h=s(2735),f=s(5805),x=s(9376),g=s(4881),v=s(8752),y=s(3804),j=s(7648);function N(e){let{params:t}=e,[s,d]=(0,r.useState)(!0),[N,b]=(0,r.useState)(null),[w,A]=(0,r.useState)([]),[R,k]=(0,r.useState)(null),S=(0,x.useRouter)(),Z=(0,g.a)(),T=null==Z?void 0:Z.user,E=t.id;function C(e){return e?new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}return((0,r.useEffect)(()=>{let e=async()=>{try{d(!0);let e=await o.t.getTemplateById(E);if(b(e),e.userId!==(null==T?void 0:T.id)&&!(null==T?void 0:T.isAdmin)){(0,v.Am)({title:"Access denied",description:"You don't have permission to view responses for this template.",variant:"destructive"}),S.push("/templates/".concat(E));return}let t=await c.getResponsesByTemplate(E);A(t);let s=await c.getResponseAggregates(E);k(s)}catch(e){console.error("Error fetching data:",e),(0,v.Am)({title:"Error",description:"Failed to load responses. Please try again.",variant:"destructive"})}finally{d(!1)}};T?e():S.push("/auth/login")},[E,T,S]),T)?(0,a.jsxs)(n.c,{user:{name:T.name,email:T.email,isAdmin:T.isAdmin},onLogout:()=>{null==Z||Z.logout(),S.push("/auth/login")},children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)(i.z,{variant:"ghost",size:"sm",onClick:()=>S.push("/templates/".concat(E)),children:[(0,a.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"Back to Template"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>S.push("/templates/".concat(E,"/statistics")),children:[(0,a.jsx)(p,{className:"mr-2 h-4 w-4"}),"Statistics"]}),(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:function(){if(!w.length)return;let e=new Set;w.forEach(t=>{Object.keys(t).forEach(t=>{["id","templateId","userId","createdAt","updatedAt","template","user"].includes(t)||e.add(t)})});let t=["ID","Submitted By","Submission Date",...Array.from(e)],s=w.map(t=>{var s;let a=[t.id,(null===(s=t.user)||void 0===s?void 0:s.name)||"Anonymous",C(t.createdAt)];return Array.from(e).forEach(e=>{let s=t[e];a.push(void 0!==s?s:"")}),a}),a=new Blob([[t.join(","),...s.map(e=>e.map(e=>'"'.concat(e,'"')).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(a),n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download","".concat((null==N?void 0:N.title)||"template","-responses.csv")),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)},disabled:!w.length,children:[(0,a.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"Export CSV"]})]})]}),s?(0,a.jsx)(u.O,{className:"h-8 w-2/3"}):(0,a.jsxs)("h1",{className:"text-2xl font-bold",children:["Responses: ",null==N?void 0:N.title]})]}),(0,a.jsxs)(l.Zb,{className:"mb-6",children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)(l.ll,{className:"text-xl",children:"Response Summary"})})}),(0,a.jsx)(l.aY,{children:s?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[void 0,void 0,void 0].map((e,t)=>(0,a.jsx)(u.O,{className:"h-24 w-full"},t))}):(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-muted/50 p-4 rounded-md",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Responses"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:w.length})]}),(null==N?void 0:N.isQuiz)&&(0,a.jsxs)("div",{className:"bg-muted/50 p-4 rounded-md",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Average Score"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:(null==R?void 0:R.avg_score)?"".concat(Math.round(10*R.avg_score)/10,"/").concat(Math.round(R.avg_total_points)):"N/A"})]}),(0,a.jsxs)("div",{className:"bg-muted/50 p-4 rounded-md",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Latest Response"}),(0,a.jsx)("div",{className:"text-lg font-medium",children:w.length>0?C(w[0].createdAt):"No responses yet"})]})]})})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"flex items-center",children:[(0,a.jsx)(f.Z,{className:"h-5 w-5 mr-2"}),"All Responses"]})}),(0,a.jsx)(l.aY,{children:s?(0,a.jsx)("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsx)(u.O,{className:"h-12 w-full"},t))}):w.length>0?(0,a.jsxs)(y.iA,{children:[(0,a.jsx)(y.Rn,{children:"A list of all responses for this template."}),(0,a.jsx)(y.xD,{children:(0,a.jsxs)(y.SC,{children:[(0,a.jsx)(y.ss,{children:"Respondent"}),(0,a.jsx)(y.ss,{children:"Date Submitted"}),(null==N?void 0:N.isQuiz)&&(0,a.jsx)(y.ss,{children:"Score"}),(0,a.jsx)(y.ss,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(y.RM,{children:w.map(e=>{var t;return(0,a.jsxs)(y.SC,{children:[(0,a.jsx)(y.pj,{className:"font-medium",children:(null===(t=e.user)||void 0===t?void 0:t.name)||"Anonymous"}),(0,a.jsx)(y.pj,{children:C(e.createdAt)}),(null==N?void 0:N.isQuiz)&&(0,a.jsx)(y.pj,{children:void 0!==e.score&&void 0!==e.totalPossiblePoints?(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium",children:[e.score,"/",e.totalPossiblePoints]}),(0,a.jsxs)("span",{className:"ml-2 text-sm text-muted-foreground",children:["(",Math.round(e.score/e.totalPossiblePoints*100),"%)"]})]}):"N/A"}),(0,a.jsx)(y.pj,{className:"text-right",children:(0,a.jsx)(i.z,{asChild:!0,variant:"outline",size:"sm",children:(0,a.jsx)(j.default,{href:"/templates/".concat(E,"/responses/").concat(e.id),children:"View Details"})})})]},e.id)})})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,a.jsx)(f.Z,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium",children:"No responses yet"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"There are no responses to this template yet."})]})})]})]}):(0,a.jsx)("div",{children:"Loading..."})}},9140:function(e,t,s){"use strict";s.d(t,{O:function(){return n}});var a=s(7437),r=s(3448);function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,r.cn)("animate-pulse rounded-md bg-muted",t),...s})}},3804:function(e,t,s){"use strict";s.d(t,{RM:function(){return o},Rn:function(){return m},SC:function(){return d},iA:function(){return l},pj:function(){return u},ss:function(){return c},xD:function(){return i}});var a=s(7437),r=s(2265),n=s(3448);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{className:"w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,n.cn)("w-full caption-bottom text-sm",s),...r})})});l.displayName="Table";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("thead",{ref:t,className:(0,n.cn)("[&_tr]:border-b",s),...r})});i.displayName="TableHeader";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,n.cn)("[&_tr:last-child]:border-0",s),...r})});o.displayName="TableBody",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,n.cn)("bg-primary font-medium text-primary-foreground",s),...r})}).displayName="TableFooter";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tr",{ref:t,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r})});d.displayName="TableRow";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("th",{ref:t,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...r})});c.displayName="TableHead";let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("td",{ref:t,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});u.displayName="TableCell";let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("caption",{ref:t,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",s),...r})});m.displayName="TableCaption"},6861:function(e,t,s){"use strict";s.d(t,{t:function(){return r}});var a=s(5493);let r={async getAllTemplates(e){try{let t=new URLSearchParams;(null==e?void 0:e.query)&&t.append("query",e.query),(null==e?void 0:e.tag)&&t.append("tag",e.tag),(null==e?void 0:e.topicId)&&t.append("topicId",e.topicId),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.page)&&t.append("page",e.page.toString()),(null==e?void 0:e.sort)&&t.append("sort",e.sort);let s=t.toString();return(await a.Z.get(s?"/templates/search?".concat(s):"/templates")).data}catch(e){return console.error("Error fetching templates:",e),[]}},getTemplateById:async e=>(await a.Z.get("/templates/".concat(e))).data,async getById(e){return this.getTemplateById(e)},createTemplate:async e=>(await a.Z.post("/templates",e)).data,updateTemplate:async(e,t,s)=>(await a.Z.put("/templates/".concat(e),{...t,version:s})).data,async deleteTemplate(e,t){await a.Z.delete("/templates/".concat(e),{data:{version:t}})},async searchTemplates(e,t){try{let s=new URLSearchParams({query:e});return(null==t?void 0:t.tag)&&s.append("tag",t.tag),(null==t?void 0:t.topicId)&&s.append("topicId",t.topicId),(null==t?void 0:t.limit)&&s.append("limit",t.limit.toString()),(null==t?void 0:t.page)&&s.append("page",t.page.toString()),(null==t?void 0:t.sort)&&s.append("sort",t.sort),(await a.Z.get("/templates/search?".concat(s))).data}catch(e){return console.error("Error searching templates:",e),[]}}}}},function(e){e.O(0,[834,360,541,64,221,439,32,961,971,117,744],function(){return e(e.s=576)}),_N_E=e.O()}]);